include: [ base, aws, network, server, lb ]
tiers:
  - name: Security
    description: Provides security infrastructure
    include: [ ]
    components:
      - type: aws-keypair
        include: [ ]
  - name: Network
    description: Provides network infrastructure
    include: [ ]
    components:
      - type: aws-sg
        include: [ network ]
  - name: Application
    description: Provides application services
    include: [ ]
    components:
      - type: aws-instance
        include: [ aws, network, server, puppet, application ]
        name: Instance 1
        output:
          lb/instances: [ instance_id ]
      - type: aws-instance
        include: [ aws, network, server, puppet, application ]
        name: Instance 2
        output:
          lb/instances: [ instance_id ]
      - type: aws-instance
        include: [ aws, network, server, puppet, application ]
        name: Instance 3
        output:
          lb/instances: [ instance_id ]
      - type: aws-instance
        include: [ aws, network, server, puppet, application ]
        name: Instance 4
        output:
          lb/instances: [ instance_id ]
    monitor:
      protocol: tcp
      port: "%(network/access_port)s"
  - name: Load Balancing
    description: Provides load balancing services
    include: [ ] 
    components:
      - type: aws-elb
        include: [ aws, lb ] 
        name: ELB
        output:
          network/access_host: dns_name
          network/admin_host: dns_name
    monitor:
      protocol: tcp
      port: "%(network/access_port)s"
      target: dns_name